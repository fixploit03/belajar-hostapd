# Internet Sharing (NAT)

## Daftar Isi
- [Apa itu Internet Sharing (NAT)?](https://github.com/fixploit03/belajar-hostapd/tree/main/docs/internet%20sharing#apa-itu-internet-sharing-nat)
- [Persyaratan](https://github.com/fixploit03/belajar-hostapd/tree/main/docs/internet%20sharing#persyaratan)
- [Instalasi iptables](https://github.com/fixploit03/belajar-hostapd/tree/main/docs/internet%20sharing#instalasi-iptables)
- [Mengaktifkan IP Forwarding](https://github.com/fixploit03/belajar-hostapd/tree/main/docs/internet%20sharing#mengaktifkan-ip-forwarding)
- [Konfigurasi NAT dengan iptables](https://github.com/fixploit03/belajar-hostapd/tree/main/docs/internet%20sharing#konfigurasi-nat-dengan-iptables)
- [Menyimpan Aturan iptables](https://github.com/fixploit03/belajar-hostapd/tree/main/docs/internet%20sharing#menyimpan-aturan-iptables)

## Apa itu Internet Sharing (NAT)?

Internet Sharing (NAT) atau Network Address Translation adalah teknologi yang memungkinkan banyak perangkat dalam satu jaringan lokal (LAN) untuk berbagi satu koneksi internet menggunakan satu alamat IP publik yang sama.

## Persyaratan

Sebelum mengkonfigurasi Internet Sharing, pastikan:
- `hostapd` sudah berjalan dengan benar
- DHCP server (`dnsmasq` atau `isc-dhcp-server`) sudah dikonfigurasi
- Interface wireless (`wlan0`) sudah memiliki IP address
- Interface internet (`eth0`) sudah terhubung ke internet
- `iptables` sudah terinstal

## Instalasi iptables

```
sudo apt-get update
sudo apt-get install iptables iptables-persistent
```

## Mengaktifkan IP Forwarding

IP Forwarding memungkinkan sistem Linux untuk meneruskan paket dari satu interface ke interface lain.

#### 1. Aktifkan IP Forwarding sementara:

```
sudo sysctl -w net.ipv4.ip_forward=1
```

#### 2. Aktifkan IP Forwarding permanen:

```
sudo nano /etc/sysctl.conf
```

Cari baris berikut:

```
#net.ipv4.ip_forward=1
```

Ubah menjadi:

```
net.ipv4.ip_forward=1
```

#### 3. Terapkan perubahan:

```
sudo sysctl -p
```

#### 4. Verifikasi status IP Forwarding:

```
cat /proc/sys/net/ipv4/ip_forward
```

Output:

```
1
```

## Konfigurasi NAT dengan iptables

#### 1. Tambahkan aturan MASQUERADE untuk NAT:

```
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```

#### 2. Izinkan traffic forwarding dari `wlan0` ke `eth0`:

```
sudo iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT
```

#### 3. Izinkan traffic forwarding dari `eth0` ke `wlan0`:

```
sudo iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT
```

#### 4. Verifikasi aturan NAT:

```
sudo iptables -t nat -L -n -v
```

Output:

```
Chain POSTROUTING (policy ACCEPT 29 packets, 4577 bytes)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MASQUERADE  0    --  *      eth0    0.0.0.0/0            0.0.0.0/0 
```

#### 5. Verifikasi aturan FORWARD:

```
sudo iptables -L FORWARD -n -v
```

Output:

```
Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 ACCEPT     0    --  wlan0  eth0    0.0.0.0/0            0.0.0.0/0           
    0     0 ACCEPT     0    --  eth0   wlan0   0.0.0.0/0            0.0.0.0/0            state RELATED,ESTABLISHED
```

## Menyimpan Aturan iptables

Secara default, aturan iptables akan hilang setelah reboot. Gunakan `iptables-persistent` untuk menyimpannya secara permanen.

#### 1. Simpan aturan iptables:

```
sudo netfilter-persistent save
```

#### 2. Verifikasi aturan tersimpan:

```
sudo cat /etc/iptables/rules.v4
```

Output:

```
# Generated by iptables-save v1.8.10 (nf_tables) on Mon Feb 16 11:01:50 2026
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A FORWARD -i wlan0 -o eth0 -j ACCEPT
-A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT
COMMIT
# Completed on Mon Feb 16 11:01:50 2026
# Generated by iptables-save v1.8.10 (nf_tables) on Mon Feb 16 11:01:50 2026
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [40:5402]
-A POSTROUTING -o eth0 -j MASQUERADE
COMMIT
# Completed on Mon Feb 16 11:01:50 2026
```
